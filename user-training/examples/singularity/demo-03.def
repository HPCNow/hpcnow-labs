Bootstrap: localimage

From: ./demo-template.simg


%help

This is a help message for the container

%setup

    touch ${SINGULARITY_ROOTFS}/tacos.txt

    touch avocados.txt


# 2. This is how to copy files for >= 2.3


%files

    avocados.txt

    avocados.txt /opt

%labels

    Maintainer Jordi Blasco (hpcnow.com)

    Version v1.0


%environment

    VADER=badguy

    LUKE=goodguy

    SOLO=someguy

    export VADER LUKE SOLO

%post

    echo "Installing Development Tools group"

    yum -y groupinstall "Development Tools"

    echo "Installing OpenMPI into container..."


    # Here we are at the base, /, of the container

    git clone https://github.com/open-mpi/ompi.git


    # Now at /ompi

    cd ompi

    ./autogen.pl

    ./configure --prefix=/usr/local

    make

    make install


    /usr/local/bin/mpicc examples/ring_c.c -o /usr/bin/mpi_ring


%runscript

    echo "Rooooar!"

    echo "Arguments received: $*"

    exec echo "$@"


%test

    /usr/local/bin/mpirun --allow-run-as-root /usr/bin/mpi_test


