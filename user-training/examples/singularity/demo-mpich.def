Bootstrap: docker

From: ubuntu 


%help

Development Enviroment with OpenMPI support

#%setup


#%files


%labels

    Maintainer Jordi Blasco (hpcnow.com)

    Version v1.0

%post

    echo "Creating required mount points"
    mkdir /scratch
    mkdir /checkpoint

    echo "Installing Development Tools group"
    apt-get update && apt-get install -y --no-install-recommends \
        apt-utils \
        build-essential \
        wget \
        curl \
        git \
        libopenblas-dev \
        libcurl4-openssl-dev \
        libfreetype6-dev \
        libpng-dev \
        libzmq3-dev \
        python-pip \
        pkg-config \
        python-dev \
        python-setuptools \
        rsync \
        software-properties-common \
        unzip \
        vim \
        zip \
        zlib1g-dev
    apt-get clean

    # IB MLNX OFED
    apt-get install -y dkms infiniband-diags libibverbs* ibacm librdmacm* libmlx4* libmlx5* mstflint libibmad.* libibumad* opensm srptools librdmacm-dev rdmacm-utils ibverbs-utils perftest vlan ibutils
    apt-get install -y libtool autoconf automake build-essential ibutils ibverbs-utils rdmacm-utils infiniband-diags perftest librdmacm-dev libibverbs-dev libmlx4-1 numactl libnuma-dev autoconf automake gcc g++ git libtool pkg-config
    apt-get install -y libnl-3-200 libnl-route-3-200 libnl-route-3-dev libnl-utils

    echo "Installing OpenMPI into container..."
    wget https://download.open-mpi.org/release/open-mpi/v4.0/openmpi-4.0.0.tar.gz
    tar -zxf openmpi-4.0.0.tar.gz
    cd openmpi-4.0.0
    ./configure --prefix=/usr/local
    make
    make install
#    /usr/local/bin/mpicc examples/ring_c.c -o /usr/bin/mpi_ring


%environment    
    LD_LIBRARY_PATH=/usr/lib/libibverbs:$LD_LIBRARY_PATH


#%runscript


#%test

#    /usr/local/bin/mpirun --allow-run-as-root /usr/bin/mpi_test
